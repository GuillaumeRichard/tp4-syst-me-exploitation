#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import sys
from connexion import Connexion
from protocole_xml import ProtocoleXml
from protocole_json import ProtocoleJson
from file_system import FileSystem
from clientManager import ClientManager
from prompt import Prompt
from messages import Messages

host = '138.197.156.251'
local_root = '../dropbox/'
server_root = 'dropbox/'

if __name__ == '__main__':

    args = sys.argv
    args_length = len(args)

    if args_length < 3 or args_length > 4:
        print(Messages.NOT_ENOUGH_ARGUMENTS)
        sys.exit(1)

    if args[2] != 'xml' and args[2] != 'json':
        print(Messages.INVALID_PROTOCOL)
        sys.exit(1)

    port = int(args[1])
    connexion = Connexion(host, port)
    file_system = FileSystem(local_root)

    if args[2] == 'xml':
        protocol = ProtocoleXml(server_root)
    else:
        protocol = ProtocoleJson(server_root)

    client = ClientManager(connexion, protocol, file_system)

    if args_length == 3:
        client.update('')
    elif args_length == 4:
        if args[3] != 'prompt':
            print(Messages.INVALID_PROMPT)
            sys.exit(1)

        prompt = Prompt(client)
        prompt.start()
