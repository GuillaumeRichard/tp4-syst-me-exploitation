import sys
from connexion import Connexion
from protocole_xml import ProtocoleXml
from protocole_json import ProtocoleJson
from file_system import FileSystem
from client import Client
from prompt import Prompt
from messages import Messages

host = '138.197.156.251'
root = '../dropbox/'


def print_answer(answer):
    print(answer)

if __name__ == '__main__':

    if len(sys.argv) < 3 or len(sys.argv) > 4:
        print(Messages.NOT_ENOUGH_ARGUMENTS)
        sys.exit(1)

    if sys.argv[2] != 'xml' and sys.argv[2] != 'json':
        print(Messages.INVALID_PROTOCOL)
        sys.exit(1)

    if sys.argv[3]:
        if sys.argv[3] != 'prompt':
            print(Messages.INVALID_PROMPT)
            sys.exit(1)

    port = int(sys.argv[1])
    connexion = Connexion(host, port)
    file_system = FileSystem(root)

    if sys.argv[2] == 'xml':
        protocol = ProtocoleXml()
    else:
        protocol = ProtocoleJson()

    client = Client(connexion, protocol, file_system)

    if sys.argv[3]:
        prompt = Prompt(client, print_answer)
