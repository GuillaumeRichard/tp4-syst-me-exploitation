#!/usr/bin/python3
# -*- coding: utf-8 -*-

from protocole import Protocole
from xml.dom.minidom import Document, parseString


class ProtocoleXml(Protocole):
    """Interface du langage de communication XML"""

    PREFIXE_XML = "<?xml version=\"1.0\" ?>"

    def __init__(self):
        super(ProtocoleXml, self).__init__()
    pass

    def message_to_xml(self, tag, text=''):
        document = Document()

        texte_a_retourner = document.createElement(tag)
        document.appendChild(texte_a_retourner)
        if text:
            texte_xml = document.createTextNode(text)
            texte_a_retourner.appendChild(texte_xml)

        return document.toxml()

    # a modifier pour interpreter une liste de dossiers en xml (car il y a des balises dans des balises)
    # et ici on ne prend en compte qu'une balise
    def interpret(self, message, tag_name):
        document = parseString(message)

        # pourquoi [0]? Je ne sais pas
        return document.getElementsByTagName(tag_name)[0].childNodes[0].data

    def get_connexion(self):
        tag = "bonjourServeur"
        return self.message_to_xml(tag)

    def get_server_name(self):
        tag = "questionNomServeur"
        return self.message_to_xml(tag)

    def verify_folder_exists(self, folder_name):
        tag = "questionListeDossiers"
        return self.message_to_xml(tag, folder_name)

    def create_folder(self, folder_name):
        tag = "creerDossier"
        return self.message_to_xml(tag, folder_name)

    def quit(self):
        tag = "quitter"
        return self.message_to_xml(tag)
