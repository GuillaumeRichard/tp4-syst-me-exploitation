from messages import Messages


class Client:
    """
    Classe repr√©sentant le client
    """

    def __init__(self, connexion, protocole, validateur_commande):
        self.quit_has_been_called = False

        self.connexion = connexion
        self.protocole = protocole
        self.validateurCommande = validateur_commande
        self.print_welcome_message()
        self.listen_for_input()

    def print_welcome_message(self):
        print(Messages.WELCOME_MESSAGE)

    def listen_for_input(self):
        while True:
            client_input = self.get_client_input()
            if self.validateurCommande.validerCommande(client_input):
                self.interpret_input(client_input)
            else:
                self.print_answer(Messages.BAD_COMMAND)

            if self.quit_has_been_called:
                break


    def get_client_input(self):
        return input(Messages.ENTER_COMMAND)

    def interpret_input(self, client_input):
        if client_input == "connecter?":
            self.greeting()
        elif client_input == "nomServeur?":
            self.get_server_name()
        elif client_input == "quitter":
            self.quit()

    def greeting(self):
        message_to_send = self.protocole.get_connexion()
        server_answer = self.get_server_answer(message_to_send)
        if "bonjourClient" in server_answer:
            self.print_answer("Oui")
        else:
            self.print_answer("Non")

    def get_server_name(self):
        tag_name = "nomServeur"

        message_to_send = self.protocole.get_server_name()
        server_answer = self.get_server_answer(message_to_send)
        interpreted_answer = self.protocole.interpret(server_answer, tag_name)
        self.print_answer(interpreted_answer)
        # if...

    def get_server_answer(self, message_to_send):
        self.connexion.send(message_to_send)
        return self.connexion.receive()

    def quit(self):
        message_to_send = self.protocole.quit()
        server_answer = self.get_server_answer(message_to_send)
        if "bye" in server_answer:
            self.print_answer("bye")
            self.connexion.close()
            self.quit_has_been_called = True
        else:
            self.print_answer(Messages.ERROR_COMMAND)

    def print_answer(self, answer):
        print(answer)
