#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import unittest
from unittest.mock import Mock
from protocole_xml import ProtocoleXml
from client import Client
from prompt import Prompt
from messages import Messages
from mock_print_answer import MockPrintAnswer


class XmlTest(unittest.TestCase):

    mock_connexion = Mock()
    mock_file_system = Mock()
    mock_input = Mock()
    protocol = ProtocoleXml()
    client = Client(mock_connexion, protocol, mock_file_system)

    def testServerConnection_ServerIsConnected_ReturnYes(self):
        self.mock_input.side_effect = ["connecter?", "quitter"]
        self.mock_connexion.receive.side_effect = ["<bonjourClient />", "<bye />"]
        prompt = Prompt(self.client)
        prompt.input_command = self.mock_input
        mock_print = MockPrintAnswer()
        prompt.print_answer = mock_print.print_answer

        prompt.start()

        expected_answer = Messages.YES
        self.assertTrue(expected_answer in mock_print.printed_answers)

    def testGetServerName_ReturnServerName(self):
        server_name = "Ubuntu Dropbox 2.0"
        self.mock_input.side_effect = ["nomServeur?", "quitter"]
        self.mock_connexion.receive.side_effect = ["<nomServeur>" + server_name + "</nomServeur>", "<bye />"]
        prompt = Prompt(self.client)
        prompt.input_command = self.mock_input
        mock_print = MockPrintAnswer()
        prompt.print_answer = mock_print.print_answer

        prompt.start()

        expected_answer = server_name
        self.assertTrue(expected_answer in mock_print.printed_answers)



if __name__ == '__main__':
    unittest.main()
